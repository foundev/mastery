<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mastery â€” Goal Tracking & Analytics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#2563eb" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    
  </head>
  <body>
    <a href="#content" class="small" style="position:absolute;left:-9999px;top:0;background:var(--focus);color:#000;padding:8px 12px;border-radius:8px;">Skip to content</a>
    <header class="appbar" role="banner">
      <div class="appbar-inner">
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="material-symbols-outlined" aria-hidden="true">track_changes</span>
          <h1 style="font-size:18px;margin:0;">Mastery</h1>
        </div>
        <nav aria-label="Top toolbar">
          <button id="openAnalyticsBtn" class="btn btn-outline" title="Open Analytics" type="button"><span class="material-symbols-outlined">analytics</span><span class="label">Analytics</span></button>
          <button id="openAchievementsBtn" class="btn btn-outline" title="View Achievements" type="button"><span class="material-symbols-outlined">emoji_events</span><span class="label">Awards</span></button>
          <button id="openP2PSyncBtn" class="btn btn-outline" title="P2P Sync" type="button"><span class="material-symbols-outlined">sync</span><span class="label">P2P Sync</span></button>
          <button id="exportBtn" class="btn btn-outline" title="Export Backup" type="button"><span class="material-symbols-outlined">download</span><span class="label">Export</span></button>
          <input id="importInput" type="file" accept="application/json" style="display:none" />
          <button id="importBtn" class="btn btn-outline" title="Import Backup" type="button"><span class="material-symbols-outlined">upload</span><span class="label">Import</span></button>
          <span id="backupStatus" class="small muted backup-status" role="status" aria-live="polite">No backup yet</span>
        </nav>
      </div>
    </header>
    <main id="content" class="container" role="main">
      <p class="subtitle">Mastery-focused goal tracking with live timers, manual entry, and analytics</p>
      <div class="row">
        <section class="card" style="flex: 1 1 100%;">
          <h2 style="margin:0 0 12px;font-size:18px;">Your Goals</h2>
          <div id="goalsList" class="list"></div>
          <div id="archivedSection" class="archived-section" style="display:none;">
            <div class="archived-header">
              <h3 style="margin:0;font-size:16px;">Archived Goals</h3>
              <p id="archivedEmpty" class="small muted" style="margin:4px 0 0;">
                Archived goals are hidden from your active list. Restore them anytime.
              </p>
            </div>
            <div id="archivedList" class="list"></div>
          </div>
        </section>
      </div>
    </main>

    <template id="goalItemTmpl">
      <div class="goal">
        <div class="stack">
          <h3></h3>
          <div class="progress" role="progressbar" aria-label="Goal progress"><span></span></div>
          <div class="meta muted small"></div>
          <div class="controls">
            <button class="btn btn-primary startBtn" title="Start Timer"><span class="material-symbols-outlined">play_arrow</span><span class="label">Start</span></button>
            <button class="btn btn-danger stopBtn" title="Stop Timer" disabled><span class="material-symbols-outlined filled">stop</span><span class="label">Stop</span></button>
            <button class="btn btn-outline addTimeBtn" title="Add Time"><span class="material-symbols-outlined">add</span><span class="label">Add</span></button>
            <button class="btn btn-outline progressBtn" title="Show Progress"><span class="material-symbols-outlined">query_stats</span><span class="label">Progress</span></button>
            <button class="btn btn-outline archiveBtn" title="Archive Goal"><span class="material-symbols-outlined">archive</span><span class="label">Archive</span></button>
            <button class="btn btn-outline deleteBtn" title="Delete"><span class="material-symbols-outlined">delete</span><span class="label">Delete</span></button>
          </div>
        </div>
        <div class="right muted small liveTimer">00:00:00</div>
      </div>
    </template>

    <template id="archivedGoalItemTmpl">
      <div class="goal archived">
        <div class="stack">
          <h3></h3>
          <div class="progress" role="progressbar" aria-label="Goal progress"><span></span></div>
          <div class="meta muted small"></div>
          <div class="controls">
            <button class="btn btn-outline restoreBtn" title="Restore Goal"><span class="material-symbols-outlined">unarchive</span><span class="label">Restore</span></button>
            <button class="btn btn-outline progressBtn" title="Show Progress"><span class="material-symbols-outlined">query_stats</span><span class="label">Progress</span></button>
            <button class="btn btn-outline deleteBtn" title="Delete"><span class="material-symbols-outlined">delete</span><span class="label">Delete</span></button>
          </div>
        </div>
        <div class="right muted small archivedBadge">Archived</div>
      </div>
    </template>

    <!-- Add Goal Modal -->
    <div id="addGoalModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addGoalTitle">
        <header><h3 id="addGoalTitle">Add New Goal</h3></header>
        <main>
          <div class="stack">
            <label class="small muted">Title</label>
            <div style="position:relative;">
              <input id="ag_title" type="text" placeholder="Goal title" autocomplete="off" />
              <div id="ag_suggestions" style="position:absolute; top:100%; left:0; right:0; background:var(--pico-background-color, #fff); border:1px solid rgba(0,0,0,.2); border-radius:8px; display:none; max-height:220px; overflow:auto; z-index: 10;"></div>
            </div>
            <label class="small muted">Description (optional)</label>
            <textarea id="ag_desc" rows="3" placeholder="Describe the goal"></textarea>
            <label class="small muted">Total hours required</label>
            <input id="ag_hours" type="number" min="0.1" step="0.1" placeholder="e.g. 200" />
          </div>
        </main>
        <footer>
          <div class="grid">
            <button id="ag_cancel" class="secondary">Cancel</button>
            <button id="ag_submit" class="primary" disabled>Add Goal</button>
          </div>
        </footer>
      </div>
    </div>

    <!-- Add Time Modal -->
    <div id="addTimeModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addTimeTitle">
        <header><h3 id="addTimeTitle">Add Time</h3></header>
        <main>
          <div id="atm_error" class="small" style="display:none; color:#d32f2f; border:1px solid #f44336; padding:10px; border-radius:8px; background:#ffebee;"></div>
          <div class="stack">
            <label class="small muted">Hours to add</label>
            <input id="atm_hours" type="number" min="0.1" step="0.1" placeholder="e.g. 1.5" />
            <label class="small muted">Date (optional)</label>
            <input id="atm_date" type="date" max="" />
          </div>
        </main>
        <footer>
          <div class="grid">
            <button id="atm_cancel" class="secondary">Cancel</button>
            <button id="atm_submit" class="primary" disabled>Add Time</button>
          </div>
        </footer>
      </div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" style="width:min(920px,95vw)">
        <header><h3 id="progressTitle">Progress</h3></header>
        <main>
          <div class="stack">
            <div id="pm_stats" class="small muted"></div>
            <div id="pm_chart" style="width:100%; height:400px;"></div>
          </div>
        </main>
        <footer>
          <button id="pm_close">Close</button>
        </footer>
      </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="analyticsTitle" style="width:min(1000px,96vw)">
        <header><h3 id="analyticsTitle">Analytics</h3></header>
        <main>
          <div class="stack">
            <div class="grid2">
              <div>
                <h4 style="margin:0 0 6px;">Daily Time Trend (All Goals)</h4>
                <div id="an_trend" style="width:100%; height:360px;"></div>
              </div>
              <div>
                <h4 style="margin:0 0 6px;">Time by Goal</h4>
                <div id="an_pie" style="width:100%; height:360px;"></div>
              </div>
            </div>
          </div>
        </main>
        <footer>
          <button id="an_close">Close</button>
        </footer>
      </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="achievementsTitle" style="width:min(900px,96vw)">
        <header><h3 id="achievementsTitle">Achievements</h3></header>
        <main>
          <div id="achievementsList" class="achievements-list"></div>
          <nav id="achievementsPagination" class="achievements-pagination" aria-label="Unlocked awards navigation">
            <button id="achievementsPrev" type="button" class="secondary">Previous</button>
            <span id="achievementsPageStatus" class="achievements-page-status" aria-live="polite"></span>
            <button id="achievementsNext" type="button" class="secondary">Next</button>
          </nav>
        </main>
        <footer>
          <button id="achievementsClose" type="button">Close</button>
        </footer>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="deleteTitle">
        <header><h3 id="deleteTitle">Delete Goal</h3></header>
        <main>
          <p><strong id="del_question">Are you sure you want to delete this goal?</strong></p>
          <p class="small muted" id="del_warning">This action cannot be undone. All tracked time will be lost.</p>
        </main>
        <footer>
          <div class="grid">
            <button id="del_cancel" class="secondary">Cancel</button>
            <button id="del_confirm" class="contrast">Yes, Delete Goal</button>
          </div>
        </footer>
      </div>
    </div>

    <!-- P2P Sync Modal -->
    <div id="p2pSyncModal" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="p2pSyncTitle" style="width:min(700px,95vw)">
        <header><h3 id="p2pSyncTitle">P2P Synchronization</h3></header>
        <main>
          <div class="stack">
            <p class="small muted">Connect two instances directly to sync data peer-to-peer. No server required!</p>

            <!-- Connection Status -->
            <div id="p2p_status" class="status-badge" style="padding:12px; border-radius:8px; background:#f1f5f9; text-align:center;">
              <strong>Status:</strong> <span id="p2p_status_text">Disconnected</span>
            </div>

            <!-- Disconnected View -->
            <div id="p2p_disconnected_view">
              <h4 style="margin:20px 0 12px; font-size:16px;">Start Connection</h4>
              <p class="small muted">Choose your role to begin pairing:</p>
              <div class="grid" style="margin-top:16px;">
                <button id="p2p_create_offer_btn" class="btn btn-primary">
                  <span class="material-symbols-outlined" style="vertical-align:middle;">call_made</span>
                  Create Offer
                </button>
                <button id="p2p_respond_btn" class="btn btn-outline">
                  <span class="material-symbols-outlined" style="vertical-align:middle;">call_received</span>
                  Respond to Offer
                </button>
              </div>
            </div>

            <!-- Initiator View (Create Offer) -->
            <div id="p2p_initiator_view" style="display:none;">
              <h4 style="margin:20px 0 12px; font-size:16px;">Step 1: Share Your Code</h4>
              <p class="small muted">Copy this code and send it to the other device:</p>
              <textarea id="p2p_offer_code" readonly rows="6" style="font-family:monospace; font-size:12px; resize:vertical;"></textarea>
                <div id="p2p_offer_qr_wrapper" class="qr-preview" style="display:none;">
                  <canvas id="p2p_offer_qr" width="0" height="0" aria-hidden="true"></canvas>
                  <p class="small muted">Show this QR code to the other device to auto-fill the offer.</p>
                </div>
              <button id="p2p_copy_offer_btn" class="btn btn-outline">
                <span class="material-symbols-outlined" style="vertical-align:middle;">content_copy</span>
                Copy Code
              </button>

              <h4 style="margin:20px 0 12px; font-size:16px;">Step 2: Paste Answer Code</h4>
              <p class="small muted">Paste the answer code you received:</p>
              <textarea id="p2p_answer_input" rows="6" placeholder="Paste answer code here..." style="font-family:monospace; font-size:12px; resize:vertical;"></textarea>
                <div class="qr-scan">
                  <button id="p2p_answer_scan_btn" class="btn btn-outline" type="button">
                    <span class="material-symbols-outlined" style="vertical-align:middle;">qr_code_scanner</span>
                    Scan QR
                  </button>
                  <div id="p2p_answer_scan" class="qr-scan-view" style="display:none;">
                    <video id="p2p_answer_scan_video" playsinline muted></video>
                    <p id="p2p_answer_scan_status" class="small muted"></p>
                  </div>
                </div>
              <button id="p2p_complete_btn" class="btn btn-primary">
                <span class="material-symbols-outlined" style="vertical-align:middle;">link</span>
                Complete Connection
              </button>
            </div>

            <!-- Responder View (Answer Offer) -->
            <div id="p2p_responder_view" style="display:none;">
              <h4 style="margin:20px 0 12px; font-size:16px;">Step 1: Paste Offer Code</h4>
              <p class="small muted">Paste the offer code you received:</p>
              <textarea id="p2p_offer_input" rows="6" placeholder="Paste offer code here..." style="font-family:monospace; font-size:12px; resize:vertical;"></textarea>
                <div class="qr-scan">
                  <button id="p2p_offer_scan_btn" class="btn btn-outline" type="button">
                    <span class="material-symbols-outlined" style="vertical-align:middle;">qr_code_scanner</span>
                    Scan QR
                  </button>
                  <div id="p2p_offer_scan" class="qr-scan-view" style="display:none;">
                    <video id="p2p_offer_scan_video" playsinline muted></video>
                    <p id="p2p_offer_scan_status" class="small muted"></p>
                  </div>
                </div>
              <button id="p2p_create_answer_btn" class="btn btn-primary">
                <span class="material-symbols-outlined" style="vertical-align:middle;">reply</span>
                Generate Answer
              </button>

              <div id="p2p_answer_display" style="display:none;">
                <h4 style="margin:20px 0 12px; font-size:16px;">Step 2: Share Your Answer</h4>
                <p class="small muted">Copy this answer code and send it back:</p>
                <textarea id="p2p_answer_code" readonly rows="6" style="font-family:monospace; font-size:12px; resize:vertical;"></textarea>
                  <div id="p2p_answer_qr_wrapper" class="qr-preview" style="display:none;">
                    <canvas id="p2p_answer_qr" width="0" height="0" aria-hidden="true"></canvas>
                    <p class="small muted">Show this QR code to the first device so it can paste your answer.</p>
                  </div>
                <button id="p2p_copy_answer_btn" class="btn btn-outline">
                  <span class="material-symbols-outlined" style="vertical-align:middle;">content_copy</span>
                  Copy Code
                </button>
              </div>
            </div>

            <!-- Connected View -->
            <div id="p2p_connected_view" style="display:none;">
              <h4 style="margin:20px 0 12px; font-size:16px;">Connected!</h4>
              <p class="small muted">You can now sync your data with the connected peer.</p>
              <div class="grid" style="margin-top:16px;">
                <button id="p2p_sync_now_btn" class="btn btn-primary">
                  <span class="material-symbols-outlined" style="vertical-align:middle;">sync</span>
                  Sync Now
                </button>
                <button id="p2p_disconnect_btn" class="btn btn-outline">
                  <span class="material-symbols-outlined" style="vertical-align:middle;">link_off</span>
                  Disconnect
                </button>
              </div>
            </div>
          </div>
        </main>
        <footer>
          <button id="p2p_close_btn">Close</button>
        </footer>
      </div>
    </div>

    <div id="achievementToast" class="achievement-toast" aria-live="polite" aria-atomic="true"></div>

    <button id="openAddGoalFab" class="fab" title="Add New Goal" aria-label="Add New Goal"><span class="material-symbols-outlined">add</span></button>

    
  
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
